<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>LIFF Redirect to Google Form</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  </head>
  <body>
    <p id="msg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°...</p>

    <script>
      window.onload = async function () {
        try {
          const liffId = "2007632611-XV8wdkR7"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          document.getElementById("msg").innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î LIFF...";

          await liff.init({ liffId });

          if (!liff.isLoggedIn()) {
            document.getElementById("msg").innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...";
            liff.login({ redirectUri: window.location.href });
            return;
          }

          const profile = await liff.getProfile();
          const userId = profile.userId;

          const formType = new URLSearchParams(window.location.search).get("form");
          let targetUrl = "";

          if (formType === "leave") {
            targetUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdfWO8tAIboMuYoZzuQJ1MGDJ1IveoPX6XbX-sEWAEFHpTZHg/viewform?usp=pp_url&entry.400456618=" + userId;
          } else if (formType === "outside") {
            targetUrl = "https://docs.google.com/forms/d/e/1FAIpQLSexw6ckeyKf4t4xCA83gM_RqaGi3zSRkFiPitDHySe3GrOMFA/viewform?usp=pp_url&entry.1121857617=" + userId;
          } else {
            document.getElementById("msg").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°";
            return;
          }

          document.getElementById("msg").innerText = "üîÅ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°...";
          setTimeout(() => {
            window.location.href = targetUrl;
          }, 500);
        } catch (err) {
          document.getElementById("msg").innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err;
          console.error(err);
        }
      };
    </script>
  </body>
</html>
